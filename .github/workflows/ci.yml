      - name: Check for Secrets
        run: |
          set -e

          # Scan code/config files for obvious hardcoded secrets,
          # but ignore:
          # - .github (workflows contain the search patterns)
          # - node_modules
          # - infra/docker-compose.yml (contains env placeholders like ${GEMINI_API_KEY})
          # Also ignore lines that are clearly env placeholders: API_KEY=${...}

          matches="$(grep -RIn \
            --exclude-dir=node_modules \
            --exclude-dir=.git \
            --exclude-dir=.github \
            --exclude='infra/docker-compose.yml' \
            --include='*.py' --include='*.js' --include='*.ts' --include='*.yml' --include='*.yaml' \
            -E 'API_KEY=|SECRET=|TOKEN=|PASSWORD=|BEGIN (RSA|EC|OPENSSH) PRIVATE KEY' . \
            | grep -vE 'API_KEY=\$\{[^}]+\}' \
            || true)"

          if [ -n "$matches" ]; then
            echo "Possible secret found:"
            echo "$matches"
            exit 1
          fi

          echo "No hardcoded secrets detected (placeholders ignored)."

